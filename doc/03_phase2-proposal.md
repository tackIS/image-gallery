# Image Gallery Manager - Phase 2 開発提案

## 概要

Phase 1では画像・動画の基本的な管理機能とMP4動画対応を実装しました。Phase 2では、実用性を高める機能とユーザー体験の向上を目指します。

## Phase 1 の成果物（振り返り）

### 実装完了機能
- ✅ MP4動画対応（スキャン、表示、再生）
- ✅ カスタム動画プレイヤー
- ✅ メタデータ管理（コメント、タグ、評価）
- ✅ エラーハンドリング
- ✅ データベースマイグレーション
- ✅ Application Supportへの移行

### 技術スタック
- フロントエンド: React 19, TypeScript, Vite 7, Tailwind CSS
- バックエンド: Tauri v2, Rust, SQLite
- 状態管理: Zustand

## Phase 2 開発提案

### 🔧 基盤機能（最優先）

#### 1. データベース初期化機能

**目的**: UI上からデータベースを安全にリセットできる機能を提供

**背景**:
- 現在、データベースのリセットは手動でファイルを削除する必要がある
- トラブル発生時やテスト時に素早くリセットしたい
- コマンドライン操作が苦手なユーザーにも対応したい
- Phase 1で発生した「no such column: file_type」エラーなど、データベースの問題が起きた際の対処を簡単にしたい

**機能詳細**:
- データベースリセットボタン
  - 設定メニューまたはヘッダーに配置
  - 「データベースを初期化」ボタン
- 確認ダイアログ
  - 警告メッセージ表示（すべてのメタデータが失われることを明示）
  - バックアップ作成オプション
  - 「初期化する」「キャンセル」ボタン
- バックアップ機能
  - 初期化前に自動バックアップ作成オプション
  - バックアップファイル名: `gallery_backup_YYYYMMDD_HHMMSS.db`
  - バックアップは同じディレクトリに保存
- リセット処理
  - データベースファイルを削除
  - アプリケーションを再起動（または状態をリセット）
  - 新しいスキーマで自動的にデータベース再作成
- フィードバック
  - 処理中のローディング表示
  - 完了時の成功メッセージ
  - エラー時の適切なエラーメッセージ

**実装の難易度**: ⭐⭐☆☆☆ (中程度)

**技術的アプローチ**:
- Rustバックエンド: データベース削除・バックアップコマンド
- フロントエンド: 確認ダイアログコンポーネント
- Tauri dialog pluginで確認ダイアログ表示

**影響範囲**:
- 新規: `src-tauri/src/commands.rs`: `reset_database`, `backup_database`コマンド追加
- 新規: `src/components/SettingsModal.tsx`: 設定画面（データベース管理セクション）
- `src/components/Header.tsx`: 設定ボタン追加
- `src/utils/tauri-commands.ts`: Tauriコマンドラッパー追加

**セキュリティ考慮事項**:
- 誤操作防止のための確認ダイアログ
- バックアップの自動作成
- 削除は可逆的な操作にしない（確実に削除）

**所要期間**: 1週間

**UI例**:
```
┌─────────────────────────────────────┐
│ データベース管理                      │
├─────────────────────────────────────┤
│                                     │
│ データベースをリセットすると、       │
│ すべてのメタデータ（コメント、       │
│ タグ、評価）が失われます。           │
│                                     │
│ ☑ リセット前にバックアップを作成    │
│                                     │
│ [データベースを初期化]  [キャンセル] │
└─────────────────────────────────────┘
```

---

### 🎯 高優先度（実用性の高い機能）

#### 2. フィルタリング・検索機能

**目的**: 大量のメディアから目的のファイルを素早く見つける

**背景**:
- 数百枚の画像・動画を管理する場合、スクロールだけでは目的のファイルを見つけにくい
- 特定の条件でメディアを絞り込む機能が必要

**機能詳細**:
- ファイル種別フィルター
  - 「すべて」「画像のみ」「動画のみ」の切り替え
  - ヘッダーまたはサイドバーにボタン配置
- 評価によるフィルター
  - 「★3以上」「★4以上」「未評価」など
  - 評価の高いメディアのみを表示
- タグによる検索・フィルター
  - タグ名の入力で該当メディアを表示
  - 複数タグのAND/OR検索
  - タグクラウド表示（よく使うタグを視覚化）
- ファイル名による検索
  - インクリメンタルサーチ（入力しながら絞り込み）
  - 部分一致検索

**実装の難易度**: ⭐⭐☆☆☆ (中程度)

**技術的アプローチ**:
- フロントエンド: Zustandでフィルター状態を管理
- UI: ヘッダーに検索バー・フィルターボタンを追加
- データ処理: メモリ上でのフィルタリング（パフォーマンス重視）

**影響範囲**:
- `src/components/Header.tsx`: 検索UI追加
- `src/store/imageStore.ts`: フィルター状態管理
- `src/components/ImageGrid.tsx`: フィルタリングロジック

**所要期間**: 2-3週間

---

#### 3. ソート機能

**目的**: メディアを整理して見やすくする

**背景**:
- 現状はスキャンした順序でしか表示されない
- ユーザーが望む順序でメディアを閲覧したい

**機能詳細**:
- ソート基準
  - ファイル名（アルファベット順）
  - 作成日時（古い順/新しい順）
  - 評価（高い順/低い順）
  - ファイルサイズ
- 昇順/降順の切り替え
- ソート状態の永続化（次回起動時も維持）

**実装の難易度**: ⭐☆☆☆☆ (簡単)

**技術的アプローチ**:
- JavaScriptの配列sortメソッドを使用
- ソート状態をlocalStorageに保存

**影響範囲**:
- `src/components/Header.tsx`: ソートUI追加
- `src/store/imageStore.ts`: ソート関数実装
- `src/components/ImageGrid.tsx`: ソート済み配列の表示

**所要期間**: 1週間

---

#### 4. キーボードショートカット

**目的**: 効率的な操作を実現

**背景**:
- マウス操作のみでは効率が悪い
- パワーユーザー向けの機能として需要が高い

**機能詳細**:
- ナビゲーション
  - `←` / `→`: 前へ/次へ移動（詳細モーダル内）
  - `Esc`: モーダルを閉じる
  - `Home` / `End`: 最初/最後のメディアへ移動
- 動画操作
  - `Space`: 再生/一時停止
  - `M`: ミュート切り替え
  - `F`: フルスクリーン
- メタデータ編集
  - `1-5`: 評価を設定
  - `E`: メタデータ編集モードに切り替え
- その他
  - `Cmd+F` / `Ctrl+F`: 検索バーにフォーカス
  - `?`: ショートカット一覧を表示（ヘルプモーダル）

**実装の難易度**: ⭐⭐☆☆☆ (中程度)

**技術的アプローチ**:
- Reactのグローバルキーボードイベントハンドラー
- 各コンポーネントでuseEffectとaddEventListenerを使用
- ショートカット一覧はモーダルで表示

**影響範囲**:
- `src/components/ImageDetail.tsx`: キーイベントハンドラー追加
- `src/components/VideoPlayer.tsx`: キーボード操作対応
- 新規: `src/components/KeyboardShortcutsModal.tsx`

**所要期間**: 1-2週間

---

### 📊 中優先度（ユーザー体験向上）

#### 5. お気に入り機能

**目的**: 重要なメディアをマーク

**背景**:
- 特定のメディアにすぐアクセスしたい
- 評価とは別の軸で分類したい

**機能詳細**:
- ハートアイコンでお気に入り登録/解除
- お気に入りのみ表示するフィルター
- グリッド表示でハートアイコン表示
- データベースに`is_favorite`カラム追加

**実装の難易度**: ⭐☆☆☆☆ (簡単)

**技術的アプローチ**:
- データベースマイグレーション（Version 3）
- UIにハートアイコン追加（lucide-react: Heart）

**影響範囲**:
- `src-tauri/src/db.rs`: マイグレーション追加
- `src/types/image.ts`: `is_favorite`追加
- `src/components/MediaCard.tsx`: ハートアイコン表示
- `src/components/ImageDetail.tsx`: お気に入り切り替え

**所要期間**: 1週間

---

#### 6. スライドショー機能

**目的**: メディアを自動で閲覧

**背景**:
- 大量のメディアを流し見したい
- プレゼンテーションやレビュー用途

**機能詳細**:
- 自動再生機能
  - 一定間隔で次のメディアへ自動移動
  - 再生速度調整（3秒/5秒/10秒）
- コントロール
  - 再生/一時停止ボタン
  - スキップボタン
- 動画の扱い
  - 動画は自動再生せず、指定時間表示後に次へ
  - または動画再生完了後に次へ移動

**実装の難易度**: ⭐⭐☆☆☆ (中程度)

**技術的アプローチ**:
- setIntervalでタイマー管理
- スライドショーモードの状態管理

**影響範囲**:
- `src/components/ImageDetail.tsx`: スライドショー機能追加
- `src/store/imageStore.ts`: スライドショー状態管理

**所要期間**: 1-2週間

---

#### 7. ダークモード

**目的**: 視認性の向上、目の疲労軽減

**背景**:
- 夜間使用時の目の疲労軽減
- macOSのダークモードに対応

**機能詳細**:
- テーマ切り替え
  - ライト/ダーク/システム設定に従う
- ヘッダーにトグルボタン配置
- Tailwind CSSのdark:クラスを活用
- 選択したテーマをlocalStorageに保存

**実装の難易度**: ⭐⭐☆☆☆ (中程度)

**技術的アプローチ**:
- Tailwind CSSのdark mode機能を使用
- カスタムフックでテーマ管理

**影響範囲**:
- `tailwind.config.js`: darkMode設定
- `src/components/Header.tsx`: テーマ切り替えUI
- すべてのコンポーネント: dark:クラス追加
- 新規: `src/hooks/useTheme.ts`

**所要期間**: 1-2週間

---

### 🚀 低優先度（高度な機能）

#### 8. 他の動画フォーマット対応

**目的**: より多くのメディア形式をサポート

**対応フォーマット**:
- MOV（QuickTime）
- AVI
- MKV
- WebM

**実装の難易度**: ⭐⭐☆☆☆ (中程度)

**技術的課題**:
- ブラウザの対応状況に依存
- 一部のコーデックは再生できない可能性

**影響範囲**:
- `src-tauri/src/fs_utils.rs`: 対応拡張子追加
- ブラウザ互換性の確認

**所要期間**: 1週間

---

#### 9. 動画サムネイル生成

**目的**: 動画のサムネイルを事前生成して表示速度向上

**背景**:
- 現在は動画タグで最初のフレームを表示
- 大量の動画がある場合、ロードが遅い

**機能詳細**:
- 動画スキャン時にサムネイル画像を生成
- サムネイルをディスクに保存
- グリッド表示では生成済みサムネイルを使用

**実装の難易度**: ⭐⭐⭐⭐☆ (難しい)

**技術的課題**:
- Rustでの動画処理（ffmpegなど外部ライブラリが必要）
- サムネイル保存場所の管理
- サムネイル削除のタイミング

**影響範囲**:
- `src-tauri/src/commands.rs`: サムネイル生成コマンド
- Cargo.toml: ffmpegバインディング追加
- データベース: サムネイルパスカラム追加

**所要期間**: 2-3週間

---

#### 10. 複数ディレクトリ対応

**目的**: 複数のフォルダを同時に管理

**背景**:
- ユーザーが複数の場所にメディアを保存している
- プロジェクトごとにディレクトリを管理したい

**機能詳細**:
- 複数のディレクトリを登録
- ディレクトリリストをサイドバーに表示
- ディレクトリごとの切り替え
- すべてのディレクトリを統合表示

**実装の難易度**: ⭐⭐⭐☆☆ (やや難しい)

**技術的アプローチ**:
- データベースに`directories`テーブル追加
- `images`テーブルに`directory_id`追加

**影響範囲**:
- データベーススキーマ変更（大規模）
- UI全体の再設計（サイドバー追加）

**所要期間**: 3-4週間

---

#### 11. エクスポート機能

**目的**: メタデータを外部で利用

**背景**:
- メタデータをバックアップしたい
- 他のツールでデータを活用したい

**機能詳細**:
- エクスポート形式
  - JSON形式
  - CSV形式
- エクスポート内容
  - ファイルパス、ファイル名、種別
  - コメント、タグ、評価
  - 作成日時、更新日時
- フィルター適用済みデータのエクスポート
  - 表示中のメディアのみエクスポート可能

**実装の難易度**: ⭐⭐☆☆☆ (中程度)

**技術的アプローチ**:
- Rustでファイル書き込み
- Tauri dialog pluginでファイル保存ダイアログ

**影響範囲**:
- `src-tauri/src/commands.rs`: エクスポートコマンド追加
- `src/components/Header.tsx`: エクスポートボタン追加

**所要期間**: 1週間

---

## Phase 2 推奨実装順序

### ステップ0: 基盤整備（1週間）

1. **データベース初期化機能** (1週間)
   - Phase 2開発の基盤となる機能
   - データベースのトラブル対応を簡単に
   - UI上から安全にリセット可能
   - 開発中のテストにも有用

### ステップ1: 基本的なUX改善（3週間）

2. **ソート機能** (1週間)
   - 最も実装が簡単で効果が高い
   - ユーザーの要望が多い機能

3. **キーボードショートカット** (1週間)
   - 効率的な操作を実現
   - パワーユーザーに訴求

4. **お気に入り機能** (1週間)
   - 実装が簡単
   - 即座に使える機能

### ステップ2: 検索・フィルター（4週間）

5. **ファイル種別フィルター** (1週間)
   - 画像のみ/動画のみ表示
   - シンプルで実用的

6. **評価フィルター** (1週間)
   - 高評価メディアのみ表示
   - データベースクエリ最適化

7. **ファイル名検索** (1週間)
   - インクリメンタルサーチ
   - 基本的な検索機能

8. **タグ検索・フィルター** (1週間)
   - 複雑なフィルタリングロジック
   - タグクラウド表示

### ステップ3: 追加機能（2-3週間）

9. **ダークモード** (1週間)
   - UI/UX向上
   - 現代的なアプリに必須

10. **スライドショー** (1-2週間)
   - プレゼンテーション用途
   - レビュー効率化

### オプション: 高度な機能（必要に応じて）

11. **他の動画フォーマット対応** (1週間)
12. **エクスポート機能** (1週間)
13. **複数ディレクトリ対応** (3-4週間)
14. **動画サムネイル生成** (2-3週間)

---

## Phase 2 Epic Issue構成案

```markdown
Epic: [Phase 2] 検索・フィルタリング機能とUX改善

Phase 1で実装した基本的なメディア管理機能に加えて、
実用性を高める検索・フィルタリング機能とUX改善を実装します。

## タスク一覧

### 基盤整備
- [ ] #XX: Step 1 - データベース初期化機能の実装

### 基本的なUX改善
- [ ] #XX: Step 2 - ソート機能の実装
- [ ] #XX: Step 3 - キーボードショートカットの実装
- [ ] #XX: Step 4 - お気に入り機能の実装

### 検索・フィルター
- [ ] #XX: Step 5 - ファイル種別フィルターの実装
- [ ] #XX: Step 6 - 評価フィルターの実装
- [ ] #XX: Step 7 - ファイル名検索の実装
- [ ] #XX: Step 8 - タグ検索・フィルターの実装

### 追加機能
- [ ] #XX: Step 9 - ダークモードの実装
- [ ] #XX: Step 10 - スライドショー機能の実装

## 期待される成果物

1. UI上からのデータベース管理機能
2. 効率的なメディア検索・フィルタリング
3. キーボードによる高速操作
4. お気に入り管理
5. ダークモード対応
6. スライドショー機能

## 関連ドキュメント

- [Phase 2 開発提案](../doc/03_phase2-proposal.md)
```

---

## 実装時の注意点

### パフォーマンス
- 大量のメディア（1000枚以上）でもスムーズに動作すること
- フィルタリング・ソートは非同期処理を検討
- メモリ使用量の最適化

### データベース設計
- 新しいカラム追加時はマイグレーションを適切に実装
- インデックスの追加でクエリ最適化
- バックワード互換性の維持

### UI/UX
- 直感的なUI設計
- レスポンシブ対応の維持
- アクセシビリティの考慮

### テスト
- 各機能の動作確認
- エッジケースのテスト
- パフォーマンステスト

---

## Phase 3 以降の可能性

Phase 2完了後、以下の機能も検討できます：

- **クラウド同期**: iCloud/Dropboxとの連携
- **AI機能**: 画像認識による自動タグ付け
- **コレクション**: メディアをグループ化
- **比較機能**: 複数のメディアを並べて比較
- **外部エディタ連携**: Photoshop等で開く
- **RAW画像対応**: 一眼カメラのRAW形式サポート
- **GPS情報表示**: 撮影場所を地図で表示
- **Windows/Linux対応**: クロスプラットフォーム化

---

## まとめ

Phase 2では、実用性を高める機能を中心に実装します。
特に検索・フィルタリング機能とキーボードショートカットは、
日常的な使用で大きな効果を発揮します。

優先度の高い機能から段階的に実装し、各ステップで
ユーザーフィードバックを得ながら進めることをお勧めします。
