# プロジェクト仕様書: 画像ギャラリー管理アプリ

## 概要
- **アプリ名**: Image Gallery Manager (仮)
- **目的**: 特定ディレクトリの画像を管理し、コメントなどのメタデータを付与できるギャラリーアプリ
- **ターゲットプラットフォーム**: macOS
- **技術スタック**: Tauri + React + TypeScript + Vite + SQLite

## 主な機能
1. **画像一覧表示**
   - 説明: 指定ディレクトリ内の画像をショッピングサイト風のグリッドレイアウトで表示
   - 優先度: 高

2. **画像詳細表示**
   - 説明: 画像をクリックすると詳細画面に遷移し、大きく表示
   - 優先度: 高

3. **コメント機能**
   - 説明: 各画像にコメント、タグ、評価などを追記・編集可能
   - 優先度: 高

4. **ディレクトリ選択**
   - 説明: 読み込むディレクトリをユーザーが選択できる
   - 優先度: 中

5. **画像検索・フィルター**
   - 説明: コメントやタグで画像を検索・絞り込み
   - 優先度: 中

## UI/UX要件
### 画面構成
- **一覧画面（メイン画面）**:
  - グリッドレイアウト（3〜4カラム）
  - サムネイル画像 + ファイル名表示
  - ホバー時に簡易情報（コメントの一部など）を表示
  - ヘッダーに検索バーとディレクトリ選択ボタン

- **詳細画面**:
  - 画像を大きく表示（中央配置）
  - 右サイドバーまたは下部にメタデータ編集エリア
    - コメント入力欄（複数行テキスト）
    - タグ入力欄
    - 評価（星評価など、オプション）
  - 戻るボタンまたはESCキーで一覧に戻る
  - 前へ/次へボタンで画像を切り替え

### デザイン方針
- カラースキーム: ライトモード基本、ダークモード対応も検討
- フォント: システムフォント（-apple-system, BlinkMacSystemFont）
- レイアウト: レスポンシブ、ウィンドウサイズに応じてカラム数調整

## 技術要件
### フロントエンド
- React 18+
- TypeScript
- React Router v6 (画面遷移)
- 状態管理: Zustand（軽量で十分だろ!）
- UIライブラリ: Tailwind CSS（スタイリング）
- 画像表示: react-lazy-load-image-component（パフォーマンス重視）

### バックエンド (Tauri側)
- 必要なプラグイン:
  - tauri-plugin-sql (SQLite接続)
  - tauri-plugin-dialog (ディレクトリ選択)
  - tauri-plugin-fs (ファイルシステムアクセス)
- Rust側でのカスタムコマンド:
  - 画像ファイル一覧取得
  - 画像データのCRUD操作

### データベース設計 (SQLite)
```sql
-- imagesテーブル
CREATE TABLE images (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  file_path TEXT NOT NULL UNIQUE,
  file_name TEXT NOT NULL,
  comment TEXT,
  tags TEXT, -- JSON形式で保存
  rating INTEGER DEFAULT 0,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- インデックス
CREATE INDEX idx_file_path ON images(file_path);
CREATE INDEX idx_file_name ON images(file_name);
```

### データ管理
- ローカルストレージ: SQLiteデータベース（`~/.image_gallery/gallery.db`）
- 画像ファイル自体は元の場所に保持、パスのみDBに保存
- サムネイルキャッシュ（オプション、Phase 2で検討）

## 機能詳細
### 1. ディレクトリ選択
**目的**: ユーザーが管理したい画像フォルダを指定

**入力**:
- ディレクトリ選択ダイアログ

**処理**:
1. tauri-plugin-dialogでディレクトリを選択
2. 選択されたディレクトリ内の画像ファイル（.jpg, .jpeg, .png, .gif, .webp）を再帰的に検索
3. 各画像のパスをDBに登録（既存の場合はスキップ）

**出力**:
- 読み込んだ画像の一覧を画面に表示

**エッジケース**:
- 画像が1枚もない場合は「画像がありません」と表示
- ファイルが削除されている場合の処理（DBから削除または無効化）
- 大量の画像（1000枚以上）がある場合の処理（ページネーションまたは仮想スクロール）

### 2. 画像一覧表示
**目的**: 画像を見やすく一覧表示

**入力**:
- DBから画像データを取得

**処理**:
- グリッドレイアウトで画像を表示
- 遅延読み込み（Lazy Loading）でパフォーマンス確保

**出力**:
- サムネイル画像 + ファイル名のグリッド

**エッジケース**:
- 画像の読み込みに失敗した場合（プレースホルダー表示）
- 非常に大きい画像の処理

### 3. 画像詳細表示・コメント追記
**目的**: 画像を詳しく見て、メタデータを編集

**入力**:
- 画像ID（一覧からクリック）

**処理**:
1. 該当画像のデータをDBから取得
2. 詳細画面に遷移
3. コメント入力欄にフォーカス
4. 保存ボタンでDBに更新

**出力**:
- 更新成功メッセージ（トースト通知）

**エッジケース**:
- 保存失敗時のエラーハンドリング
- 長すぎるコメント（文字数制限検討）
- 画像ファイルが移動・削除された場合

### 4. 検索・フィルター（Phase 2）
**目的**: 大量の画像から目的の画像を見つけやすく

**入力**:
- 検索キーワード、タグフィルター

**処理**:
- SQLiteのLIKE句で検索
- タグでのフィルタリング

**出力**:
- 絞り込まれた画像一覧

## 非機能要件
- **パフォーマンス**: 
  - 起動時間: 3秒以内
  - 1000枚の画像でもスムーズにスクロール
- **セキュリティ**: 
  - ファイルシステムアクセスは選択されたディレクトリのみ
  - SQLインジェクション対策（プリペアドステートメント使用）
- **アクセシビリティ**: 
  - キーボード操作対応（Tab, Enter, ESC）
  - 画像のalt属性設定

## 開発フェーズ
### Phase 1: MVP（最優先）
- [ ] プロジェクトセットアップ（Tauri + React + TypeScript）
- [ ] SQLiteデータベース初期化
- [ ] ディレクトリ選択機能
- [ ] 画像一覧表示（基本的なグリッド）
- [ ] 画像詳細表示
- [ ] コメント追加・編集機能
- [ ] データの永続化

### Phase 2: 機能拡張
- [ ] 検索・フィルター機能
- [ ] タグ機能
- [ ] 評価（星評価）機能
- [ ] サムネイルキャッシュ
- [ ] ダークモード対応

### Phase 3: 改善
- [ ] パフォーマンス最適化（仮想スクロール）
- [ ] UI/UXブラッシュアップ
- [ ] キーボードショートカット追加
- [ ] 設定画面（カラム数、サムネイルサイズなど）

## 参考資料
- UIイメージ: 楽天市場やAmazonの商品一覧のようなグリッドレイアウト
- 類似アプリ: Google Photos、Adobe Lightroom（簡易版）

## 制約事項
- macOS専用（Phase 1）
- オフラインで動作すること
- 画像ファイルは移動・削除しない（パスのみ保持）

## その他の注意点
### Claude Codeへの指示
- エラーハンドリングを丁寧に実装すること
- TypeScriptの型を厳密に定義すること
- コンポーネントは再利用可能な形で設計すること
- SQLite操作はRust側で実装し、フロントからはTauriコマンド経由で呼び出すこと
- ファイル名やパスはサニタイズすること

### コーディング規約
- コンポーネント名: PascalCase
- 関数名: camelCase
- ファイル名: kebab-case
- CSS: Tailwind CSSのユーティリティクラス優先
